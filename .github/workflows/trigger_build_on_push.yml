name: Trigger Build on Push

on:
  push:
    branches:
      - develop
      - master

jobs:

  build:
    runs-on: ubuntu-latest
    name: Build and Publish Workflow

    steps:

    - name: Extract Branch
      id: id: extract_branch
      run: echo "::set-output name=branch::${GITHUB_REF##*/}"

    - name: Build Docker Image
      uses: aurelien-baudet/workflow-dispatch@v2
      with:
        workflow: Build and Publish Docker Image
        token: ${{ secrets.ACTIONS_ACCESS_TOKEN }}
        inputs: '{ "git_commit": "${{ steps.vars.outputs.branch }}", "image_tag": "${{ steps.vars.outputs.branch }}" }'

    # - name: Build VM
    #   uses: aurelien-baudet/workflow-dispatch@v2
    #   with:
    #     workflow: Create and Bootstrap Virtual Machine
    #     token: ${{ secrets.ACTIONS_ACCESS_TOKEN }}
    #     inputs: '{ "name": "pushtest", "swarm": "false" }'

    # - name: Deploy
    #   uses: aurelien-baudet/workflow-dispatch@v2
    #   with:
    #     workflow: Create and Bootstrap Virtual Machine
    #     token: ${{ secrets.ACTIONS_ACCESS_TOKEN }}
    #     inputs: '{ "name": "pushtest", "swarm": "false" }'