name: Trigger Build on Push

on:
  push:
    branches:
      - develop
      - master

jobs:

  build:
    runs-on: ubuntu-latest
    name: Build and Publish Workflow

    steps:

    - name: Build Docker Image
      uses: aurelien-baudet/workflow-dispatch@v2
      with:
        workflow: Build and Publish Docker Image
        token: ${{ secrets.ACTIONS_ACCESS_TOKEN }}
        inputs: '{ "git_commit": '' + "${GITHUB_REF##*/}" + '', "image_tag": "${GITHUB_REF##*/}" }'

    # - name: Build VM
    #   uses: aurelien-baudet/workflow-dispatch@v2
    #   with:
    #     workflow: Create and Bootstrap Virtual Machine
    #     token: ${{ secrets.ACTIONS_ACCESS_TOKEN }}
    #     inputs: '{ "name": "pushtest", "swarm": "false" }'

    # - name: Deploy
    #   uses: aurelien-baudet/workflow-dispatch@v2
    #   with:
    #     workflow: Create and Bootstrap Virtual Machine
    #     token: ${{ secrets.ACTIONS_ACCESS_TOKEN }}
    #     inputs: '{ "name": "pushtest", "swarm": "false" }'